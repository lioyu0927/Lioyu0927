<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>음악 취향 매칭 메인</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
    .container { display: flex; height: 100vh; }

    /* 왼쪽 필터 */
    .filter-box {
      width: 220px;
      background: #fff;
      padding: 15px;
      border-right: 1px solid #ddd;
      box-shadow: 2px 0 5px rgba(0,0,0,0.05);
      overflow-y: auto;
    }
    .filter-section { margin-bottom: 20px; }
    .filter-section strong { display: block; margin-bottom: 5px; }
    .filter-section label { display: block; margin: 4px 0; cursor: pointer; font-size: 14px; }

    /* 가운데 프로필 리스트 */
    .profile-list {
      flex: 1;
      padding: 20px;
      overflow-y: scroll;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    .profile {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .profile:hover { transform: scale(1.02); }
    .profile h3 { margin: 0; font-size: 18px; }
    .profile p { margin: 5px 0; font-size: 14px; }
    .match-bar { height: 8px; border-radius: 5px; background: #ddd; margin-top: 5px; }
    .match-bar-fill { height: 100%; border-radius: 5px; background: #4caf50; }

    /* 오른쪽 상세 패널 */
    .detail-panel {
      width: 300px;
      background: #fff;
      border-left: 1px solid #ddd;
      padding: 15px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }
    .detail-panel h2 { margin: 0 0 10px; }
    .detail-panel p { margin: 5px 0; font-size: 14px; }
    .chat-btn {
      margin-top: auto;
      padding: 8px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    /* 채팅창 */
    .chat-box {
      position: fixed;
      bottom: 10px;
      right: 320px;
      width: 300px;
      height: 400px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .chat-messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      font-size: 14px;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #ddd;
    }
    .chat-input input {
      flex: 1;
      border: none;
      padding: 8px;
      font-size: 14px;
    }
    .chat-input button {
      padding: 8px 12px;
      border: none;
      background: #2196f3;
      color: white;
      cursor: pointer;
    }
    .msg { margin: 5px 0; }
    .me { text-align: right; color: #2196f3; }
    .other { text-align: left; color: #333; }
  </style>
</head>
<body>

  <div class="container">
    <!-- 필터 -->
    <div class="filter-box">
      <h3>필터</h3>

      <div class="filter-section">
        <strong>성별</strong>
        <label><input type="radio" name="gender" value="all" checked> 전체</label>
        <label><input type="radio" name="gender" value="male"> 남성만</label>
        <label><input type="radio" name="gender" value="female"> 여성만</label>
      </div>

      <div class="filter-section">
        <strong>Matching Point</strong>
        <label><input type="radio" name="match" value="0" checked> All</label>
        <label><input type="radio" name="match" value="30"> 30%+</label>
        <label><input type="radio" name="match" value="50"> 50%+</label>
        <label><input type="radio" name="match" value="70"> 70%+</label>
      </div>

      <div class="filter-section">
        <strong>아티스트</strong>
        <label><input type="radio" name="artist" value="all" checked> 전체</label>
        <label><input type="radio" name="artist" value="Parannoul"> Parannoul</label>
        <label><input type="radio" name="artist" value="들국화"> 들국화</label>
        <label><input type="radio" name="artist" value="미상"> 미상</label>
        <label><input type="radio" name="artist" value="Syncopation"> Syncopation</label>
        <label><input type="radio" name="artist" value="검정치마"> 검정치마</label>
      </div>
    </div>

    <!-- 프로필 리스트 -->
    <div id="profileList" class="profile-list"></div>

    <!-- 상세 패널 -->
    <div id="detailPanel" class="detail-panel">
      <h2>프로필 상세</h2>
      <p>프로필을 선택하세요.</p>
    </div>
  </div>

  <script>
    const myProfile = {
      name: "나",
      gender: "male",
      artists: ["Parannoul", "검정치마", "Coldplay"]
    };

    const profiles = [
      { name: "지민", age: 19, gender: "female", region: "서울", artists: ["Parannoul", "들국화", "IU"] },
      { name: "승현", age: 20, gender: "male", region: "부산", artists: ["검정치마", "BTS"] },
      { name: "수빈", age: 18, gender: "female", region: "대구", artists: ["미상", "Syncopation", "Coldplay"] },
      { name: "현우", age: 21, gender: "male", region: "인천", artists: ["들국화", "Nirvana", "Parannoul"] },
      { name: "지호", age: 22, gender: "female", region: "서울", artists: ["검정치마", "미상", "NewJeans"] },
      { name: "태윤", age: 23, gender: "male", region: "광주", artists: ["Syncopation", "Radiohead"] },
      { name: "서연", age: 19, gender: "female", region: "부산", artists: ["Parannoul", "검정치마", "Coldplay"] },
      { name: "민재", age: 21, gender: "male", region: "대전", artists: ["들국화", "미상"] },
      { name: "하린", age: 20, gender: "female", region: "서울", artists: ["Syncopation", "검정치마"] },
      { name: "도윤", age: 22, gender: "male", region: "인천", artists: ["미상", "Parannoul", "검정치마"] }
    ];

    function calcMatch(userArtists) {
      const common = userArtists.filter(a => myProfile.artists.includes(a));
      return Math.round((common.length / myProfile.artists.length) * 100);
    }

    function renderProfiles() {
      const genderFilter = document.querySelector('input[name="gender"]:checked').value;
      const minMatch = parseInt(document.querySelector('input[name="match"]:checked').value);
      const artistFilter = document.querySelector('input[name="artist"]:checked').value;

      const list = document.getElementById("profileList");
      list.innerHTML = "";

      profiles.forEach(p => {
        const match = calcMatch(p.artists);
        const genderOk = (genderFilter === "all" || p.gender === genderFilter);
        const matchOk = (match >= minMatch);
        const artistOk = (artistFilter === "all" || p.artists.includes(artistFilter));

        if (genderOk && matchOk && artistOk) {
          const div = document.createElement("div");
          div.className = "profile";
          div.innerHTML = `
            <h3>${p.name} (${p.age}, ${p.gender === "male" ? "남" : "여"}, ${p.region})</h3>
            <p><b>선호 아티스트:</b> ${p.artists.join(", ")}</p>
            <p><b>Matching Point:</b> ${match}%</p>
            <div class="match-bar"><div class="match-bar-fill" style="width:${match}%;"></div></div>
          `;
          div.onclick = () => showDetail(p, match);
          list.appendChild(div);
        }
      });
    }

    function showDetail(profile, match) {
      const detail = document.getElementById("detailPanel");
      detail.innerHTML = `
        <h2>${profile.name}</h2>
        <p><b>나이:</b> ${profile.age}</p>
        <p><b>성별:</b> ${profile.gender === "male" ? "남성" : "여성"}</p>
        <p><b>지역:</b> ${profile.region}</p>
        <p><b>선호 아티스트:</b> ${profile.artists.join(", ")}</p>
        <p><b>Matching Point:</b> ${match}%</p>
        <button class="chat-btn" onclick="openChat('${profile.name}')">채팅하기</button>
      `;
    }

    function openChat(name) {
      if (document.getElementById("chatBox")) return; // 이미 열려있으면 무시

      const chatBox = document.createElement("div");
      chatBox.className = "chat-box";
      chatBox.id = "chatBox";
      chatBox.innerHTML = `
        <div class="chat-messages" id="chatMessages">
          <div class="msg other">${name}: 안녕! 반가워 :)</div>
        </div>
        <div class="chat-input">
          <input type="text" id="chatInput" placeholder="메시지를 입력하세요...">
          <button onclick="sendMessage('${name}')">전송</button>
        </div>
      `;
      document.body.appendChild(chatBox);
    }

    function sendMessage(name) {
      const input = document.getElementById("chatInput");
      const msg = input.value.trim();
      if (!msg) return;
      const messages = document.getElementById("chatMessages");

      // 내 메시지
      const myMsg = document.createElement("div");
      myMsg.className = "msg me";
      myMsg.innerText = "나: " + msg;
      messages.appendChild(myMsg);

      input.value = "";
      messages.scrollTop = messages.scrollHeight;

      // 더미 응답
      setTimeout(() => {
        const reply = document.createElement("div");
        reply.className = "msg other";
        reply.innerText = `${name}: 흥미롭네!`;
        messages.appendChild(reply);
        messages.scrollTop = messages.scrollHeight;
      }, 800);
    }

    // 필터 변경 시 자동 적용
    document.querySelectorAll('.filter-box input').forEach(input => {
      input.addEventListener("change", renderProfiles);
    });

    renderProfiles();
  </script>
</body>
</html>